<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--mapper映射-->
<mapper namespace="com.gameloft9.demo.dataaccess.dao.system.TpQueInvestigationMapper">
    <resultMap id="InvestigationResultMap" type="com.gameloft9.demo.dataaccess.model.system.TpQueInvestigation">
        <id column="qid" property="qid" jdbcType="INTEGER"/>
        <result column="history" property="history" jdbcType="INTEGER"/>
        <result column="startTime" property="startTime" jdbcType="TIMESTAMP"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
    </resultMap>
    <resultMap id="SubjectResultMap" type="com.gameloft9.demo.dataaccess.model.system.TpQueSubject">
        <id column="sid" property="sid" jdbcType="INTEGER"/>
        <result column="question" property="question" jdbcType="VARCHAR"/>
        <result column="oid" property="oid" jdbcType="INTEGER"/>
        <result column="option" property="option" jdbcType="VARCHAR"/>
    </resultMap>
    <resultMap id="TotalResultMap" type="com.gameloft9.demo.dataaccess.model.system.TpQueTotal">
        <id column="toid" property="toid" jdbcType="INTEGER"/>
        <result column="oid" property="oid" jdbcType="INTEGER"/>
        <result column="qid" property="qid" jdbcType="INTEGER"/>
    </resultMap>
    <!--查询全部-->
    <select id="findAll2" resultMap="InvestigationResultMap">
        SELECT tqc.title history,tqi.startTime,res.resName status,tqi.qid
        FROM tp_questionnaire_investigation AS tqi,
             tp_questionnaire_creating AS tqc,
             tp_resourcelist AS res
        WHERE tqc.cid=tqi.history
        and tqi.`status`=res.id
        order by status,startTime desc
        limit #{start,jdbcType=DECIMAL},#{end,jdbcType=DECIMAL}
    </select>
    <!--统计数据条数-->
    <select id="getCount2" resultType="Integer" parameterType="map">
        SELECT count(1)
        FROM tp_questionnaire_investigation
        WHERE 1=1
        <if test="qid !=null and qid != ''">
            and
            qid = #{qid, jdbcType=VARCHAR}
        </if>
    </select>
    <!--tp_questionnaire_investigation添加-->
    <insert id="add2" parameterType="java.lang.String">
        INSERT INTO tp_questionnaire_investigation(history,startTime,status)
        VALUES (#{history},#{startTime},#{status})
    </insert>

    <insert id="addTotal" parameterType="java.lang.String">
        INSERT INTO tp_questionnaire_total(oid,qid)
        VALUES (#{oid},#{qid})
    </insert>
    <!--修改-->
    <update id="update2" parameterType="com.gameloft9.demo.dataaccess.model.system.TpQueInvestigation">
        UPDATE tp_questionnaire_investigation
        SET status=36
        WHERE qid = #{qid, jdbcType=VARCHAR}
    </update>
    <!--整套历史表的qid为索引的多表删除-->
        <!--根据cid-->
    <select id="findById2" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT tp_questionnaire_investigation.history
        FROM  tp_questionnaire_investigation WHERE qid= #{qid, jdbcType=VARCHAR}
    </select>
        <!--查询sid-->
    <select id="findById4" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT tqs.sid
        FROM tp_questionnaire_investigation AS tqi,
        tp_questionnaire_creating as tqc,
        tp_questionnaire_subject as tqs,
        tp_questionnaire_option AS tqo
        WHERE tqc.cid=tqs.oid
        and tqc.cid=tqi.history
        and tqs.sid=tqo.sid
        and tqi.qid=#{qid,jdbcType=VARCHAR}
    </select>
        <!--删除-->
    <delete id="delete2_6" parameterType="java.lang.String">
        DELETE from tp_democratic_verification where recordId = #{qid}
    </delete>
    <delete id="delete2_4" parameterType="java.lang.String">
        DELETE from tp_questionnaire_total where tp_questionnaire_total.qid = #{qid}
    </delete>
    <delete id="delete2_2" parameterType="java.lang.String">
        DELETE from tp_questionnaire_option where tp_questionnaire_option.sid = #{sid}
    </delete>
    <delete id="delete2_3" parameterType="java.lang.String">
        DELETE from tp_questionnaire_subject where tp_questionnaire_subject.oid = #{history}
    </delete>
    <delete id="delete2" parameterType="java.lang.String">
        DELETE FROM tp_questionnaire_investigation  where tp_questionnaire_investigation.qid = #{qid}
    </delete>
    <delete id="delete2_5" parameterType="java.lang.String">
        DELETE FROM tp_questionnaire_template  where tp_questionnaire_template.cid = #{history}
    </delete>
    <delete id="delete2_1" parameterType="java.lang.String">
        DELETE from tp_questionnaire_creating where tp_questionnaire_creating.cid = #{history}
    </delete>
    <!--整套模板表的tid为索引的多表删除-->
        <!--根据tid找到cid-->
    <select id="findById7" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT tp_questionnaire_template.cid
        FROM  tp_questionnaire_template WHERE tid= #{tid, jdbcType=VARCHAR}
    </select>
        <!--根据cid找到subject的sid-->
    <select id="findById8" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT tp_questionnaire_subject.sid
        FROM  tp_questionnaire_subject WHERE oid= #{cid, jdbcType=VARCHAR}
    </select>
        <!--删除-->
    <delete id="delete8_1" parameterType="java.lang.String">
        DELETE from tp_questionnaire_option where tp_questionnaire_option.sid = #{sid}
    </delete>
    <delete id="delete8_2" parameterType="java.lang.String">
        DELETE from tp_questionnaire_subject where tp_questionnaire_subject.oid = #{cid}
    </delete>
    <delete id="delete8_3" parameterType="java.lang.String">
        DELETE FROM tp_questionnaire_template  where tp_questionnaire_template.tid = #{tid}
    </delete>
    <delete id="delete8_4" parameterType="java.lang.String">
        DELETE from tp_questionnaire_creating where tp_questionnaire_creating.cid = #{cid}
    </delete>
    <!--根据qid查询统计的oid-->
    <select id="getTotal" resultMap="TotalResultMap">
        SELECT tp_questionnaire_total.oid
        FROM tp_questionnaire_total
        WHERE tp_questionnaire_total.qid = #{qid}
    </select>
    <!--删除提交过的账号-->
    <delete id="delete9" parameterType="java.lang.String">
        DELETE from tp_democratic_verification where content = #{content}
    </delete>
</mapper>
